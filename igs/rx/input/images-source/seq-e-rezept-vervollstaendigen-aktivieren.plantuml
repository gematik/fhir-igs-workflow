@startuml
title E-Rezept vervollstaendigen und Task aktivieren

actor "Verordnender" as V
participant "Primaersystem" as PS
participant "Identity Provider" as IDP
participant "E-Rezept Fachdienst" as FD

V -> PS: Verordnung vervollstaendigen()
activate PS

opt kein gueltiger AuthN-Token
  ref over PS, IDP: AuthN-Token anfordern
end

PS -> FD: POST /Task/{id}/$activate (AuthN-Token, QES-Bundle)
activate FD
FD -> FD: Signatur pruefen()
FD -> FD: Verordnungsdaten validieren()
FD -> FD: Task aktivieren()
FD --> PS: Task (aktiv), Status
deactivate FD

PS --> V: Status
deactivate PS

@enduml
